<!-- src/app/components/home/home.html -->
<div class="container mt-5 pt-5">

  <!-- HEADER -->
  <div class="row mb-4">
    <div class="col-12">
      <h1 class="fw-bold">GP Dashboard</h1>
      <p class="text-muted">Overview of patient activity and priority tasks.</p>
    </div>
  </div>

  <!-- PENDING REQUEST ALERT -->
  <div class="row mb-3" *ngIf="pendingRequests > 0">
    <div class="col-12">
      <div class="alert alert-warning shadow-sm d-flex justify-content-between align-items-center"
           style="cursor:pointer"
           (click)="router.navigate(['/gp/patients'])">
        <div><strong>{{ pendingRequests }}</strong> appointment request(s) waiting.</div>
        <strong>Review →</strong>
      </div>
    </div>
  </div>

  <!-- QUICK STATS -->
  <div class="row g-3 mb-4">

    <div class="col-md-3">
      <div class="card shadow-sm h-100">
        <div class="card-body">
          <h6 class="text-secondary">Total Patients</h6>
          <h2 class="fw-bold">{{ totalPatients }}</h2>
        </div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card shadow-sm h-100">
        <div class="card-body">
          <h6 class="text-secondary">Appointments</h6>
          <h2 class="fw-bold">{{ totalAppointments }}</h2>
        </div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card shadow-sm h-100">
        <div class="card-body">
          <h6 class="text-secondary">Prescriptions</h6>
          <h2 class="fw-bold">{{ totalPrescriptions }}</h2>
        </div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card shadow-sm h-100">
        <div class="card-body">
          <h6 class="text-secondary">Care Plans</h6>
          <h2 class="fw-bold">{{ totalCareplans }}</h2>
        </div>
      </div>
    </div>

  </div>

  <!-- MAP + RECENT APPOINTMENTS -->
  <div class="row g-3 mb-4">

    <!-- MAP -->
    <div class="col-xl-7">
      <div class="card shadow-sm h-100">
        <div class="card-body p-0 d-flex flex-column">

          <div class="p-3 border-bottom bg-light">
            <h4 class="mb-0">Patient Locations</h4>
          </div>

          <div class="flex-grow-1 position-relative">

            <google-map
              height="450px"
              width="100%"
              [options]="mapOptions">

              <!-- Markers = simple LatLngLiteral objects -->
              @for (m of mapMarkers; track m.lat + ',' + m.lng) {
                <map-marker [position]="m"></map-marker>
              }
            </google-map>

            @if (mapMarkers.length === 0) {
              <div
                class="position-absolute top-0 start-0 w-100 h-100 d-flex justify-content-center align-items-center text-muted">
                No location data available
              </div>
            }
          </div>

        </div>
      </div>
    </div>

    <!-- RECENT APPOINTMENTS -->
    <div class="col-xl-5">
      <div class="card shadow-sm h-100">
        <div class="card-body">
          <h4 class="mb-3">Recent Appointments</h4>

          @if (recentAppointments.length === 0) {
            <p class="text-muted">No recent appointments.</p>
          } @else {
            <div class="list-group">
              @for (a of recentAppointments; track a._id) {
                <div class="list-group-item">
                  <div class="d-flex justify-content-between">
                    <strong>{{ a.patient }}</strong>
                    <small>{{ a.date | date:'dd MMM yyyy' }}</small>
                  </div>
                  <small class="text-muted">
                    Doctor: {{ a.doctor }}
                    •
                    <span class="badge bg-{{ a.status === 'completed' ? 'success' : 'warning' }}">
                      {{ a.status }}
                    </span>
                  </small>
                </div>
              }
            </div>
          }
        </div>
      </div>
    </div>

  </div>

  <!-- GP CHECKLIST -->
  <div class="row g-3 mb-5">

    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-body">
          <h4 class="mb-3">GP Work Checklist</h4>

          <ng-container *ngIf="gpChecklist.length > 0; else noTasks">
            <ul class="list-group">

              @for (t of gpChecklist; track t.patient + t.type) {
                <li class="list-group-item d-flex justify-content-between align-items-start">
                  <div>
                    <strong>{{ t.type }}</strong> — {{ t.patient }}<br>
                    <small class="text-muted">{{ t.action }}</small>
                  </div>
                  <button class="btn btn-sm btn-primary"
                          [routerLink]="t.link">
                    View
                  </button>
                </li>
              }

            </ul>
          </ng-container>

          <ng-template #noTasks>
            <p class="text-muted">No pending tasks for review.</p>
          </ng-template>

        </div>
      </div>
    </div>

  </div>

</div>
