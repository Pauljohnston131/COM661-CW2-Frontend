<div class="dashboard-container">

  <div class="dashboard-header">
    <div>
      <h2 class="dashboard-title">GP Practice Dashboard</h2>
      <p class="text-muted mb-0 greeting-text">
         {{ today | date:'fullDate' }}
      </p>
    </div>

    <div class="d-flex gap-3 align-items-center flex-wrap">

   
      <div class="quick-actions d-flex flex-row align-items-center">

  <button class="btn nav-action-btn me-2" [routerLink]="['/gp/patients']">
    <i class="bi bi-person-lines-fill"></i> View Patients
  </button>

  <button class="btn nav-action-btn me-2" [routerLink]="['/gp/add-patient']">
    <i class="bi bi-person-plus"></i> Add Patient
  </button>

  <button class="btn nav-action-btn me-2" [routerLink]="['/gp/patients']">
    <i class="bi bi-pencil-square"></i> Update Patient Information
  </button>

  <button class="btn nav-action-btn me-2" [routerLink]="['/gp/delete-patient']">
  <i class="bi bi-person-x"></i> Delete Patient
</button>


</div>


      <button class="btn review-btn shadow-sm d-flex align-items-center gap-2"
              (click)="goToFirstPending()"
              [disabled]="pendingRequests === 0">
        
        Review pending requests
        <span class="badge bg-dark ms-2">{{ pendingRequests }}</span>
      </button>

    </div>
  </div>

 
  <div class="stats-grid">

    <div class="stat-tile glass-card">
      <div class="stat-icon text-primary"><i class="bi bi-people-fill"></i></div>
      <div>
        <div class="stat-value">{{ totalPatients }}</div>
        <div class="stat-label">Total Patients</div>
      </div>
    </div>

    <div class="stat-tile glass-card">
      <div class="stat-icon text-success"><i class="bi bi-calendar-check"></i></div>
      <div>
        <div class="stat-value">{{ totalAppointments }}</div>
        <div class="stat-label">Appointments</div>
      </div>
    </div>

    <div class="stat-tile glass-card">
      <div class="stat-icon text-info"><i class="bi bi-prescription2"></i></div>
      <div>
        <div class="stat-value">{{ totalPrescriptions }}</div>
        <div class="stat-label">Prescriptions</div>
      </div>
    </div>

    <div class="stat-tile glass-card">
      <div class="stat-icon text-purple"><i class="bi bi-heart-pulse-fill"></i></div>
      <div>
        <div class="stat-value">{{ totalCareplans }}</div>
        <div class="stat-label">Active Care Plans</div>
      </div>
    </div>

  </div>

 
  <div class="main-grid-3">

    
    <div class="checklist-section">
      <div class="section-header">
        <h5>Today's Priority Tasks</h5>
        <span class="badge bg-purple text-white">{{ gpChecklist.length }}</span>
      </div>

      <div class="checklist-container glass-card">
        <ng-container *ngIf="gpChecklist.length; else noTasks">
          <div class="checklist-list">
            <div class="checklist-card"
     *ngFor="let item of gpChecklist | slice:0:8"
     [appHighlightUrgent]="item.type === 'Appointment Request'"
     (click)="router.navigate(item.link)">

              <div class="d-flex justify-content-between align-items-start">
                <div class="grow">
                  <div class="checklist-type text-purple">{{ item.type }}</div>
                  <div class="checklist-patient fw-semibold">{{ item.patient }}</div>
                  <div class="text-muted small">{{ item.date | date:'shortDate' }}</div>
                </div>
                <div class="text-end">
                  <div class="checklist-action fw-semibold text-primary">{{ item.action }} â†’</div>
                </div>
              </div>
            </div>
          </div>
        </ng-container>

        <ng-template #noTasks>
          <div class="text-center py-5 text-muted">
            <i class="bi bi-check-circle display-4 text-success opacity-25"></i>
            <p class="mt-3">All clear! No pending actions.</p>
          </div>
        </ng-template>
      </div>
    </div>

    <div class="activity-section">
      <div class="section-header"><h5>Recent Activity</h5></div>

      <div class="activity-list glass-card">
        <div *ngFor="let a of recentAppointments" class="activity-item">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <div class="fw-semibold">{{ a.patient }}</div>
              <div class="small text-muted">
                {{ a.date | date:'mediumDate' }} with {{ a.doctor }}
              </div>
            </div>

            <span class="badge rounded-pill"
              [ngClass]="{
                'bg-success': a.status === 'completed',
                'bg-warning text-dark': a.status === 'scheduled',
                'bg-light text-muted border': a.status === 'cancelled'
              }">
              {{ a.status }}
            </span>
          </div>
        </div>

        <div *ngIf="!recentAppointments.length" class="text-center text-muted py-4">
          No recent appointments
        </div>
      </div>
    </div>

    <div class="calendar-section">
      <div class="calendar-card glass-card">
        <app-home-calendar [events]="events"></app-home-calendar>
      </div>
    </div>

  </div>

  <div class="map-section mt-4">
    <div class="section-header">
      <h5>Patient Map</h5>
      <small class="text-muted">{{ mapMarkers.length }} plotted</small>
    </div>

    <div class="map-container-small glass-card">
      <google-map height="100%" width="100%"
                  [center]="mapCenter"
                  [zoom]="mapZoom"
                  [options]="mapOptions">
        <map-marker *ngFor="let m of mapMarkers" [position]="m"></map-marker>
      </google-map>
    </div>
  </div>

</div>
